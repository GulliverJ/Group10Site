<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Group 10</title>
    <!-- Bootstrap -->
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <link rel="icon" type="type/png" href="img/favicon_3.png"/>
  </head>
  <body data-spy="scroll" data-target=".scrollspy">

    <!-- Top navbar -->
    <div class="navbar navbar-fixed-top">
      <div class="wrapper">

        <div class="logo">
          <a href="index.html"><img src="img/title.png"></a>
        </div>
        <div class="nav" id="topnav">
          <ul>
            <li style="display: inline"><a href="show.html" class="nav-list">Showcase</a></li>
            <li style="display: inline"><a href="" class="nav-list onpage">Demo</a></li>
            <li style="display: inline"><a href="collab.html" class="nav-list">Collaborate</a></li>
            <li style="display: inline"><a href="docs.html" class="nav-list">Documentation</a></li>
            <li style="display: inline"><a href="dev.html" class="nav-list">Development</a></li>
            <li style="display: inline"><a href="http://orangesensorsapis.freeforums.net/" class="nav-list">Forum</a></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Dark grey page header -->
    <div class="pageheader">
      <div class="container">
        <div>
          <h1 style="color: #f60">Demonstration</h1>
          <p class="pageblurb">Some appropriate graphics and text saying something to the effect of "See our system in action through our Smart Parking app"</p><br>
        </div>
      </div>
    </div>

    <div class="content-body">
      <div class="container">
        <div class="row">

          <!-- Side nav -->
          <div class="col-md-3 nopadding scrollspy" id="leftcol">
            <div class="affix-top" id="sidebar" data-spy="affix">
                <ul class="nav hidden-xs hidden-sm">
                  <li style="background-color: #1b1b1b; padding-top: 10px; border-top-left-radius: 10px; border-top-right-radius: 10px; border: 1px #eee solid"><span style="padding: 16px; color: #fff">Navigation</span><p></li>
                  <li><a href="#final">Final Product</a></li>
                  <li><a href="#design">Design</a></li>
                  <li><a href="#javaapi">Using the Java API for analytics</a></li>
                  <li><a href="#analytics">Running analytics</a></li>
                  <li><a href="#simulator">Simulating Sensors</a></li>
                </ul>
            </div>
          </div>

          <!-- MAIN CONTENT -->
          <div class="col-md-9 nopadding main-content">

            <!-- Final Product -->
            <h2 style="margin-top: 12px">Final Product</h2>
            <a class="anchor" id="final"></a>
            <hr>
            <h4 style="font-weight: lighter">Our clients tasked us with developing a smart-parking application, built upon the larger sensor network platform. The application was to indicate the state of street-side parking bays across london - where they were, how long they'd been occupied for, whether it was legal to park there, and more. Since starting the project, we've prototyped various hardare for parking bay monitors and produced a fully functioning web app.</h4>
            <h4 style="text-align: center"><a href="http://victokoh.cs.ucl.ac.uk/parking/">Click here to try our smart-parking app</a></h4><br>
            <p>Of course, a lot of planning and design went into every aspect of this demonstration of the system in use. See below for a detailed analysis of how exactly we did it, and discover how the sensors network streamlines the development process.</p>

            <!-- Design -->
            <h2>Design</h2>
            <a class="anchor" id="design"></a>
            <hr>
            <ul>
              <li>A high-level diagram of the backend design</li>
              <li>Will include talking about the databases</li>
              <li>Brief description of how to achieve it</li>
            </ul>
            <div class="imgborder">
              <img class="img-responsive img-rounded" style="margin-left: auto; margin-right: auto;" src="img/icons_legend.png">
              <p>The custom icons used in our application to indicate the state of a given parking bay.</p>
            </div>
            
            <!-- Java API -->
            <h2>Using the Java API for analytics</h2>
            <a class="anchor" id="javaapi"></a>
            <hr>
				<p>
					The general process carried out for analytics is as follows: <br>
The CQL database is accessed twice making use of the JAVA API built, data gained from this is processed in the class
named 'Analytics' and whether a change of state has occurred along with its associated timestamp is uploaded to a
separate SQL database hosting parking information.
				</p><p>
There are three primary Java classes involved in carrying out the back end analytics for the smart parking app.
<br>
These are:<br>
	<ul>
	<li>
	<strong>Bay</strong> - For creating Bay objects. The number of objects initialised within the Parking class correspond to the
	number of Bays within the SQL database 'orangeparking'. This class extends the observable design pattern and
	is used to notify the Analytics class's observer when a change in state (occupied/ unoccupied) has occurred so
	an update to the SQL database can occur. 
	</li><li>
	<strong>Parking</strong> - Makes an initial connection to the SQL database to retrieve an initial set of data on all bays present. 
	It also includes an update function which accepts a bay object, creates a new connection and updates the bay_data's
	occupied and state_timespan fields based upon bay_id.
	</li><li>
	<strong>Analytics</strong> - This class represents the main thread running analytics. An initial call is made to the CQL database
	making use of the JAVA API built. This collects the set of all sensor ids (global_ids) of which matches the Bay objects.
	A second call to the CQL database is then made via the API. Given the new time stamp retrieved differs from the previous
	reading's, an assumption is made that an update in the actual CQL database has occurred for that specific sensor id
	associated with a bay. Whether it is occupied or not is then worked out via the sensor reading retrieved. This
	then calls the specific Bay object's setOccupied function and the SQL parking database is updated.
	</li>
	</ul>
</p>
<p>
At present, the majority of analytics is performed within a read-only SQL view table.
There are two key reasons for this choice. Other than calculating whether a bay is 'occupied' (1 | 0) and the time this state change occurred, all other information of interest to be displayed on our web app is already implicitly known and can be calculated
in a less resource heavy fashion. Views also update via lazy evaluation, 'on the spot' when called by PHP server-side code on our web app. This is better suited for our purposes in providing time sensitive information immediately such as the 'time remaining' one can remain occupied in a bay.   
</p><br>
<p>
The information provided within the view table includes:
<br>
<ul>
<li>
The nearest available bay <br>
	This is worked out given the current state of a bay. If a bay is unoccupied, then it itself is its nearest
	available bay. Consequently, given a bay is occupied, a list of all unoccupied bays within the area are found 
	and making use of basic pythagorus, the next nearest available bay is identified.
</li><li>
	Time remaining <br>
	Given a restriction_id and that max_stay is not NULL within the restrictions table of the SQL Parking database,
	Time remaining represents the amount of time left (in seconds) one can be within an occupied bay state while still being 		'legally parked'.
	Likewise, this is only calculated if a bay is occupied. Otherwise if it is unoccupied and max_stay does not list a 
	time restriction, it is set to NULL.
</li><li>
Legally occupied<br> 
	The legally occupied field is calculated based on three different conditions.
	Provided a bay is indeed occupied:
		If the current time of occupation exists outside of the restriction start and end timings,
		no restrictions apply. 
		Else if occupation occurs within restricted hours, given the time remaining in seconds when the difference is
		taken from max_stay is still positive, legally occupied is set to true.
	Otherwise, it is set to NULL.
</li><br>  
Additional: <br>
<li>
Restricted <br>
	Calculates whether restrictions are currently active for a specific bay (joined to a specific restrictions_id)
</li>
</ul>
The schema for the overall orangeparking database can be found here:
		//input link
			
</p>            
            <!-- Simulator -->
            <h2>Simulating Sensors</h2>
            <a class="anchor" id="simulator"></a>
            <hr>
            <ul>
              <li>Details about the sensor simulator</li>
              <li>Code samples</li>
              <li>Download link for sample simulator code</li>
            </ul>

          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid footer">
      <p style="float: right">This project is proudly presented in partnership with</p>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script>
    $('#sidebar').affix({
      offset: {
        top: $('#sidebar').offset().top - 92
      }
    });
    </script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js' type='text/javascript'></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug
    <script src="./Starter Template for Bootstrap_files/ie10-viewport-bug-workaround.js"></script> -->
</body></html>
